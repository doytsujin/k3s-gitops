---
- name: Stop systemd-resolved
  ansible.builtin.systemd:
    name: systemd-resolved
    state: stopped
    enabled: no

- name: Remove resolv.conf symlink
  ansible.builtin.file:
    path: /etc/resolv.conf
    state: absent

- name: Create new resolv.conf file
  ansible.builtin.blockinfile:
    path: /etc/resolv.conf
    mode: 0644
    create: true
    block: |
      nameserver "{{ dns_server }}"
