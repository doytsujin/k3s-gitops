---
- name: interfaces | configure status and description
  loop: "{{ vyos_interfaces }}"
  vyos.vyos.vyos_interfaces:
    config:
    - name: "{{ item['interface'] }}"
      description: "{{ item['desc'] | default(item['name'] | upper) }}"
      enabled: "{{ item['enabled'] | default(true) }}"
  when:
    - item['vlan_id'] is not defined 

- name: interfaces | configure status and description | VIF
  loop: "{{ vyos_interfaces }}"
  vyos.vyos.vyos_interfaces:
    config:
    - name: "{{ item['interface'] }}"
      vifs:
      - description: "{{ item['desc'] | default(item['name'] | upper) }}"
        enabled: "{{ item['enabled'] | default(true) }}"
        vlan_id: "{{ item['vlan_id'] }}"
  when:
    - item['vlan_id'] is defined

- name: interfaces | configure L3 IPv4
  loop: "{{ vyos_interfaces }}"
  vyos_l3_interfaces:
    config:
      - name: "{{ item['interface'] }}"
        ipv4:
        - address: "{{ item['ipv4_addr'] }}"
  when: 
    - item['ipv4_addr'] is defined
    - item['vlan_id'] is not defined

- name: interfaces | configure L3 IPv4 | VIF
  loop: "{{ vyos_interfaces }}"
  vyos_l3_interfaces:
    config:
      - name: "{{ item['interface'] }}"
        vifs:
        - vlan_id: "{{ item['vlan_id'] }}"
          ipv4:
          - address: "{{ item['ipv4_addr'] }}"
  when: 
    - item['ipv4_addr'] is defined
    - item['vlan_id'] is defined